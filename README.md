# Gaussian Splatting论文阅读笔记

## Gaussian Splatting的整体流程解读

首先先用一句话来概括3D高斯：从已有的点云模型出发，以每个点为中心，建立可学习的3D高斯表达，并用Splatting也即抛雪球的方法进行渲染。

![image](https://github.com/user-attachments/assets/ce66fe71-31e7-4cbd-a9d5-dfa565a145b1)

**第一步**：我们需要通过colmap使用SFM算法估计出初始的3D点云sfm Points，假设初始点云有10000个点。

**第二步**：我们需要将点云中的每个点膨胀成3D高斯椭球，这些椭球的初始形状：

- 是一个各向同性的高斯球，即一个圆球
- 使用knn法，找到3个邻近的点，然后将这三个点距离的平均作为高斯球的半径
- 然后每个椭球的参数包含：
  * 中心点位置： $(x, y, z)$
  * 协方差矩阵(控制椭球形状)： $R, S$
  * 球谐函数系数(控制椭球颜色)： $16*3$
  * 透明度： $\ \alpha \$

**第三步**：通过渲染(Splatting)将所有的高斯球投影到2D图像平面上，形成一张图片。

**第四步**：将生成的图像和GT图去做loss，再反向传播回来优化每个椭球的参数。

**第五步**：作者还根据反向传播回来的梯度信息去做了一个自适应密度控制，对应pipline中的(Adaptive Control of Gaussian)

- 简单来说，就是
  * 太大的椭球进行拆分
  * 太小的椭球进行克隆
  * 存在感(透明度)太低的椭球进行删除

![image](https://github.com/user-attachments/assets/dec0c859-6aa6-4b67-b1b6-20206cc15b1f)

---

看完上面这个流程，相信大家脑海里面浮现出了许多问题❓：


为了方便探究问题的细节，我们可以将pipline划分为三个核心的部分：

- 捏雪球
- 抛雪球：从3D投影到2D，得到足迹
- 加以合成，形成最后的图像

![image](https://github.com/user-attachments/assets/04ddec5b-a795-46f9-9262-360869d3f36a)

---
## 捏雪球过程我们需要解决的问题

**问题1：根据我们前面所说：我们实际输入的是一些初始的点云，这些点本质上来说是没有体积的，所以我们需要选择一个核对这些点进行膨胀。那么问题来了：这个核我们可以选择高斯/圆/正方体，这里作者为什么选择高斯？**

回答：我们先来回顾一下高斯分布：

**一维高斯分布**

对于一维高斯分布，协方差矩阵 $\Sigma$ 简化为一个标量 $\sigma$ ,均值 $\mu$ 也是一个标量，公式如下： 

$G(x) = \frac{1}{\sqrt{2\pi \sigma^2}} e^{-\frac{(x - \mu)^2}{2\sigma^2}}$

其中：

- $x$ 是变量
- $\mu$ 是均值
- $\sigma^2$ 是方差

**二维高斯分布**

对于二维高斯分布，协方差矩阵 $\Sigma$ 是 $2*2$ 的矩阵，均值 $\mu$ 是一个二维向量 $(\mu_1, \mu_2)$ 。公式如下：

$G(\mathbf{x}) = \frac{1}{2\pi |\Sigma|^{1/2}} e^{-\frac{1}{2} (\mathbf{x} - \mu)^T \Sigma^{-1} (\mathbf{x} - \mu)}$

其中：

- $\mathbf{x}$ 是一个二维向量 $(x_1, x_2)$
- $\mu$ 是均值向量 $(\mu_1, \mu_2)$
- $\Sigma$ 是协方差矩阵

$$\Sigma = \begin{pmatrix}
\sigma_{11} & \sigma_{12} \\
\sigma_{21} & \sigma_{22}
\end{pmatrix}$$

- $|\Sigma|$是协方差矩阵的行列式

**三维高斯分布**

对于三维高斯分布，协方差矩阵 $\Sigma$ 是 $3*3$ 的矩阵，均值 $\mu$ 是一个三维向量 $(\mu_1, \mu_2, \mu3)$ 。公式如下：

$G(\mathbf{x}) = \frac{1}{(2\pi)^{3/2} |\Sigma|^{1/2}} e^{-\frac{1}{2} (\mathbf{x} - \mu)^T \Sigma^{-1} (\mathbf{x} - \mu)}$

其中：

- $\mathbf{x}$ 是一个三维向量 $(x_1, x_2, x_3)$
- $\mu$ 是均值向量 $(\mu_1, \mu_2, \mu_3)$
- $\Sigma$ 是协方差矩阵

$$\Sigma = \begin{pmatrix}
\sigma_{11} & \sigma_{12} & \sigma_{13} \\
\sigma_{21} & \sigma_{22} & \sigma_{23} \\
\sigma_{31} & \sigma_{32} & \sigma_{33}
\end{pmatrix}$$

- $|\Sigma|$是协方差矩阵的行列式

**对协方差矩阵的解释**

- 是一个对称矩形，决定高斯分布的形状
- 对角线上元素为x轴/y轴/z轴的方差
- 反斜对角线上的值为协方差，
  * 表示x和y，x和z，y和z的线性相关程度

作者之所以选择3D高斯作为核来对点进行膨胀是因为3D高斯具有很好的数学性质：

- 经过仿射变换后高斯核仍然闭合
- 沿着某一个轴积分，从3D降到2D后依然为高斯

所以作者选择用3D高斯作为核

**问题2：我们选择3D高斯核对点进行膨胀，最终会得到一个椭球。那么问题来了：3D高斯表示出来为什么是一个椭球呢？**

回答：我们先来复习一下椭球的相关公式

$\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1$ 表示中心点为 $(0,0,0)$ 的标准椭球公式

---

- 具体来说就是在重建不充分的区域往往会有较大的梯度，我们可以设定一个梯度阈值，对超过梯度阈值的位置我们对椭球进行分裂或者克隆：
  * 对于方差大的位置，说明椭球的形状大，我们需要对椭球进行分裂
  * 对于方差小的位置，说明椭球的形状小，我们需要对椭球进行克隆
如果我们按照上面的流程做下来，我们会发现一个问题：就是我们虽然可以优化每个椭球的形状，颜色，透明度等，但我们始终无法改变点云的数量，强烈依赖sfm生成的初始点云数量。



